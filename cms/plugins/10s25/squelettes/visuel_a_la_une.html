[(#REM) --- LE VISUEL √Ä LA UNE ---]
<head>
    <INCLURE{fond=inclure/static_head}
    {css=/local/visuel_a_la_une.css}>
</head>

<div class="visuel_a_la_une">
    <BOUCLE_visuels(DOCUMENTS)
    {extension IN jpg,png,gif,webp}
    {statut==publie}
    {inverse}
    {0,50}>

    #SET{sum,0}
    #SET{n,0}
    <BOUCLE_votes(NOTATIONS){objet=document}{id_objet=#ID_DOCUMENT}>
    #SET{sum,#GET{sum}|plus{#NOTE}}
    #SET{n,#GET{n}|plus{1}}
    </BOUCLE_votes>

    #SET{avg,0}
    [(#GET{n}|>{0}|oui)#SET{avg,#GET{sum}|div{#GET{n}}}]

    <BOUCLE_aff(CONDITION){si #GET{n}|>{0}}>
    <div class="visuel-item" data-note="[(#GET{avg})]" data-votes="[(#GET{n})]">
    <div class="note">
            ‚≠ê [(#GET{avg}|round{1})]/5 <small>([(#GET{n})] vote[s])</small>
        </div>
        <a href="#URL_DOCUMENT" class="mediabox visuel" rel="visuels" title="[(#TITRE|attribut_html)]">
            <img src="#URL_DOCUMENT" alt="[(#TITRE|attribut_html)]" class="visuel-image">
        </a>
    </div>
    </BOUCLE_aff>

    </BOUCLE_visuels>

    <p class="rien">Aucun visuel not√© pour le moment.</p>
<//B_visuels>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wrap = document.querySelector('.visuel_a_la_une');
        if (!wrap) return;

        const items = [...wrap.querySelectorAll('.visuel-item')];
        if (items.length === 0) return;

        // ü•á Trier d'abord par note, puis par nombre de votes
        items.sort((a, b) => {
            const noteA = parseFloat(a.dataset.note || 0);
            const noteB = parseFloat(b.dataset.note || 0);
            const votesA = parseInt(a.dataset.votes || 0);
            const votesB = parseInt(b.dataset.votes || 0);

            // On trie d'abord par note d√©croissante, puis par nombre de votes d√©croissant
            if (noteB !== noteA) return noteB - noteA;
            return votesB - votesA;
        });

        // On garde uniquement le premier (meilleur selon les deux crit√®res)
        for (let i = 1; i < items.length; i++) {
            items[i].remove();
        }

        wrap.appendChild(items[0]);
    });
</script>

