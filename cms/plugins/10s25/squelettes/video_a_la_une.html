[(#REM) --- LA VID√âO √Ä LA UNE ---]
<head>
    <INCLURE{fond=inclure/static_head}
    {css=/local/video_a_la_une.css}>
</head>

<div class="video_a_la_une">
    <BOUCLE_videos(DOCUMENTS)
    {extension IN html,mp4,webm,ogv}
    {oembed!=''}
    {inverse}
    {statut==publie}
    {0,50}>

    #SET{sum,0}
    #SET{n,0}
    <BOUCLE_votes(NOTATIONS){objet=document}{id_objet=#ID_DOCUMENT}>
    #SET{sum,#GET{sum}|plus{#NOTE}}
    #SET{n,#GET{n}|plus{1}}
    </BOUCLE_votes>

    #SET{avg,0}
    [(#GET{n}|>{0}|oui)#SET{avg,#GET{sum}|div{#GET{n}}}]

    <BOUCLE_aff(CONDITION){si #GET{n}|>{0}}>
    <div class="video-item"
         data-note="[(#GET{avg})]"
         data-votes="[(#GET{n})]">

        <div class="video-container">
            [(#MODELE{emb,id_document=#ID_DOCUMENT, async=non,largeur=800,hauteur=450})]
        </div>

        <div class="note">
            ‚≠ê [(#GET{avg}|round{1})]/5
            <small>([(#GET{n})] vote[s])</small>
        </div>
    </div>
    </BOUCLE_aff>

    </BOUCLE_videos>

    <p class="rien">Aucune vid√©o not√©e pour le moment.</p>
<//B_videos>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wrap = document.querySelector('.video_a_la_une');
        if (!wrap) return;

        const items = [...wrap.querySelectorAll('.video-item')];
        if (items.length === 0) return;

        // ü•á Tri combin√© : meilleure note, puis plus de votes
        items.sort((a, b) => {
            const noteA = parseFloat(a.dataset.note || 0);
            const noteB = parseFloat(b.dataset.note || 0);
            const votesA = parseInt(a.dataset.votes || 0);
            const votesB = parseInt(b.dataset.votes || 0);

            if (noteB !== noteA) return noteB - noteA;
            return votesB - votesA;
        });

        // Garde uniquement la meilleure
        for (let i = 1; i < items.length; i++) {
            items[i].remove();
        }

        wrap.appendChild(items[0]);
    });
</script>
