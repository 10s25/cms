[(#REM) --- LA VIDÉO À LA UNE ---]
<head>
    <INCLURE{fond=inclure/static_head}
    {css=/local/video_a_la_une.css}>
</head>

<div class="video_a_la_une">
    <BOUCLE_videos(DOCUMENTS)
    {extension IN html,mp4,webm,ogv}
    {oembed!=''}
    {inverse}
    {statut==publie}
    {0,50}>

    #SET{sum,0}
    #SET{n,0}
    <BOUCLE_votes(NOTATIONS){objet=document}{id_objet=#ID_DOCUMENT}>
    #SET{sum,#GET{sum}|plus{#NOTE}}
    #SET{n,#GET{n}|plus{1}}
    </BOUCLE_votes>

    #SET{avg,0}
    [(#GET{n}|>{0}|oui)#SET{avg,#GET{sum}|div{#GET{n}}}]

    <BOUCLE_aff(CONDITION){si #GET{n}|>{0}}>
    <div class="video-item" data-note="[(#GET{avg})]">
        <div class="video-container">
            [(#MODELE{emb,id_document=#ID_DOCUMENT, async=non,largeur=800,hauteur=450})]
        </div>
        <div class="note">
            ⭐ [(#GET{avg}|round{1})]/5 <small>([(#GET{n})] vote[s])</small>
        </div>
    </div>
    </BOUCLE_aff>

    </BOUCLE_videos>

    <p class="rien">Aucune vidéo notée pour le moment.</p>
<//B_videos>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const wrap = document.querySelector('.video_a_la_une');
        if (!wrap) return;

        const items = [...wrap.querySelectorAll('.video-item')];
        if (items.length === 0) return;

        // Trouver la vidéo la mieux notée
        items.sort((a, b) => parseFloat(b.dataset.note || 0) - parseFloat(a.dataset.note || 0));

        // Supprimer toutes les autres
        for (let i = 1; i < items.length; i++) {
            items[i].remove();
        }

        // S'assurer que la meilleure est affichée en premier
        wrap.appendChild(items[0]);
    });
</script>
